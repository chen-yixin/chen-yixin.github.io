---
title: 网络工程师-局域网基础
categories: 软考
top: false
comments: true
toc: true
date: 2021-03-28 17:06:35
cover: //img.hoboro.top/picgo/20210320181828.png?imageView2/0/w/240/h/145
---

软考中级 > 网络工程师 > 7.局域网基础

<!-- more -->

[来源](https://www.bilibili.com/video/BV18Z4y1A7Yk)

## 局域网概念

- 局域网 LAN
  - 有限的区域内多台计算机通过传输介质互连
- 传输介质
  - 双绞线
  - 同轴电缆(淘汰)
  - 光纤
  - 无线
- 特点
  - 范围小,较高的数据传输速率和较低的时延
- 拓扑结构
  - 总线型
  - 星型
  - 环形(令牌环网)

## IEEE802 标准

- IEEE802 局域网参考模型
  - 数据链路层
    - 逻辑链路控制层 LLC 统一 LLC 子层为上层提供服务
    - 介质访问控制层 MAC 与具体接入的传输介质有关
  - 物理层
- 子标准
  - IEEE802.3 CSMA/CD 介质接入控制方法和物理层技术规范(以太网)
  - IEEE802.11 无线局域网标准

## 以太网

- 冲突问题 => CSMA/CD
  - 载波侦听
    - 非坚持型监听: 信道空闲=>发送,信道忙碌=>等待`t`时间再监听
    - 1-坚持型监听: 信道空闲=>发送,信道忙碌=>持续监听
    - p-坚持型监听: 信道空闲=>发送,信道忙碌=>`p`概率等待`1-p`概率持续监听
  - 冲突检测
    - 争用期: 以太网端到端往返时延 2t(碰撞窗口)
    - 最短帧长计算: 传输时延 >= 2 \* 传播时延
  - 发现冲突,停止检测
  - 随机延迟重发 => 截断二进制指数退避算法
    - 确定退避时间 2t
    - 从离散的整数集合[0,1,...,{% mathjax %}2^k-1{% endmathjax %}]随机取一个数,记作 r,重传应推后 r\*2t,其中`k=min(重传次数,10)`
    - 重传 16 次仍未成功,丢弃该帧,向高层报告
- 地址 => MAC 地址
  - 48 位二进制代码(24bit 供应标识+24bit 供应商对网卡的唯一编号)
  - 前 8 位中的最后一位:
    - 0 => 物理地址(单播地址)
    - 1 => 逻辑地址(组播地址)
  - 48 位全 1 => 广播 MAC 地址
- 数据帧规范
  ![以太网V2帧格式](//img.hoboro.top/picgo/20210328132655.png)
  - 以太网 V2 帧格式(事实工业标准)
  - IEEE802.3 帧格式
  - 类型部分(2Byte):
    - IP / IPX
    - 在 IEEE802.3 帧格式中替换成长度字段
    - `<1500` => 表示为长度字段
    - `>1536` => 表示为那种协议
  - 最小帧长: 64Byte
  - 最大帧长: 1518Byte
- 传输介质
  - 无屏蔽双绞线 UTP
  - 屏蔽双绞线 STP
    ![双绞线线序](//img.hoboro.top/picgo/20210328133548.png)、
  - 同轴电缆(淘汰)
  - 光缆
    - 多模光纤
      - 光信号在传递过程中,多次反射,模式色散
      - 每段 <500m
      - 带宽不如单模光纤
      - 淘汰
    - 单模光纤
      - 光信号沿直线传播
      - 每段 >3km
  - 测试指标
    - 双绞线
      - 检测设备 TDR(时域反射仪)
      - 衰减 Attenuation
      - 近端串扰 NEXT
      - 直流电阻
      - 阻抗特性
      - 衰减串扰比 ACR
      - 电缆特性 SNR
      - 传播时延 T
    - 光纤
      - 检测设备 OTDR(光学时域反射仪)
      - 光纤连通性检测
      - 光纤衰减检测
      - 光纤污染检测
      - 光纤故障定位检测
- 快速以太网
  - 技术特点
    - 100Mbps
    - 相同的帧格式
    - 半双工(CSMA/CD)/全双工(不会冲突)
    - 标准 100Base-T
  - 传输介质标准
    - 100Base-TX 双绞线
    - 100Base-FX 两芯单模/多模光纤
    - 100Base-T4 三类 4 对非屏蔽双绞线(3 对数据传输+1 对数据检测,半双工系统)
    - 100Base-T2 全双工
- 千兆以太网
  - 技术特点
    - 1000Mbps
    - 相同的帧格式
    - 半双工/全双工
  - 传输介质标准
    - 1000Base-T (IEEE802.3ab,五类非屏蔽双绞线,每段<100m)
    - 100Base-SX (IEEE802.3z,多模光纤,每段<550m)
    - 100Base-LX (IEEE802.3z,单模光纤,每段可达到 3km)
    - 100Base-CX (IEEE802.3z,屏蔽双绞线,每段<25m)
- 万兆以太网
  - 技术特点
    - 10000Mbps
    - 相同的帧格式
    - 全双工
  - 传输介质标准
    - 局域网物理层
    - 可选的广域网物理层
- 端口自协商
- 冲突域和广播域
  | | 分割冲突域 | 分割广播域 |
  | --- | :---: | :---: |
  | 集线器/物理层 | × | × |
  | 交换机/链路层 | √ | × |
  | 路由器/网络层 | √ | √ |
- 交换机
  - 以太网帧中的目标地址转发数据(MAC-端口映射表)
    - 广播 如果 MAC 地址表中没有,则向接收到该数据帧以外全部端口广播该数据帧
    - 学习 学习接收的数据帧的**源 MAC 地址**形成
    - 转发 根据 MAC 地址表单播转发数据帧
      - 快速转发 不做差错校验
      - 存储转发 收到数据帧后存储起来做差错校验,再转发出去,延迟会比较大
      - 碎片丢弃 收到帧前 64 字节做校验,前两者折中
    - 更新
      - MAC 地址表的老化时间 300s
      - 如果发现入端口和 MAC 地址表中源 MAC 地址所在端口不同,交换机将 MAC 地址重新学习到新的端口
  - 分割冲突域,实现全双工通信,不使用 CSMA/CD
  - 用户独享带宽,增加总容量(`背板带宽=端口数*每个端口带宽*2`)
  - 堆叠和级联
    - 级联可通过一根双绞线再任何设备厂家交换机之间进行
    - 级联可使用普通端口,也可使用 uplink 端口
    - 堆叠只能再同厂家设备之间进行
    - 需要专用堆叠模块和堆叠线缆
    - 堆叠后所有交换机可视为一个整体交换机进行管理
    - 堆叠模式: 菊花链式(可靠性高)、星形(转发效率高)

## 虚拟局域网 VLAN(IEEE802.1Q)

- 802.1Q 帧
  ![802.1Q帧结构](//img.hoboro.top/picgo/20210328150041.png)
- VLAN 划分方法
  - 静态 VLAN 基于交换机端口划分
  - 动态 VLAN
    - 基于 MAC
    - 基于协议 IP/IPX
    - 基于子网
    - 基于策略
- 端口类型
  - Access 端口 连接终端,只允许一个 VLAN 帧通过
  - Trunk 端口 连接其他交换机
    - 允许多个 VLAN 通过
    - 除了缺省 VLAN(VLAN1)外,其他 VLAN 都带标签通过 Trunk 口
    - VLAN1:不带标签通过 Trunk 口,到达交换机后重新打上 VLAN 标签
  - Hybrid 端口
    - 可以连接终端,可以连接其他交换机
    - 可以选择带标签还是不带标签

![VLAN](//img.hoboro.top/picgo/20210328150724.png)

## VLAN 注册协议 GVRP

- 端口注册模式实现 VLAN 信息的传递
- Normal 模式
  - **允许**该端口动态注册或注销 VLAN
  - **允许**传播动态 VLAN 信息,**允许**传播静态 VLAN 信息
    - 静态:自身配置,动态:来自其他交换机
- Fixed 模式
  - **禁止**该端口动态注册或注销 VLAN
  - **禁止**传播动态 VLAN 信息,**允许**传播静态 VLAN 信息
- Forbidden 模式
  - **禁止**该端口动态注册或注销 VLAN
  - 不传播 VLAN1 意外任何 VLAN 信息

## 生成树协议 STP

- 可靠性 ↑ => 冗余 => 交换环路(物理环路)
- 物理环路问题
  - 广播风暴
  - 帧复制
  - MAC 地址表不稳定
- STP 协议功能
  - 经过相关计算(根据桥协议数据单元 BPDU)
  - 逻辑上端口环路
  - 当线路故障时,断开的端口被激活,恢复通信
- STP 协议算法
  - 选择根网桥
    - 根据网桥 ID,选择网桥 BID 值**最小**的交换机
    - 网桥 ID = 网桥优先级(2Byte) + 网桥 MAC(6Byte)
    - 网桥优先级
      - 缺省值 32768
      - 取值范围 0~65536
      - 以 4096 的倍数变动
  - 选择根端口
    - 在非根网桥上选择
    - 本端口到根网桥路径成本**最低**
      - 带宽越大,根路径成本越小
      - IEEE802.1d-1998 规定
        - 10Mbps => 100
        - 100Mbps => 19
        - 1000Mbps => 4
        - 10000Mbps => 2
      - 经过多条链路,路径成本累加
    - 直连的网桥 ID**最小**
    - 直连的端口 ID**最小**
      - 端口 ID = 端口优先级 + 端口编号
      - 端口优先级
        - 缺省值 128
        - 以 16 的倍数变动
  - 选择指定端口
    - 根网桥上的端口 全是
    - 非根网桥指定端口
      - 本端口所在网桥到根网桥路径成本最小
      - 本端口所在网桥的 ID 值较小
      - 本端口 ID 值较小
  - 其他端口置为阻塞状态
- 端口状态
  - 禁用 Disabled 物理关闭
  - 阻塞 Blocking 逻辑关闭,接受 BPDU 配置消息,交给 CPU 处理
  - 侦听 Listening 接收并发送 BPDU 配置消息
  - 学习 Learning 开始地址学习
  - 转发 Forwarding 转发任何数据
    ![端口状态变化时序](//img.hoboro.top/picgo/20210328155215.png)
- 快速生成树协议 RSTP
  - 标准: IEEE802.1w -> IEEE802.1D-2004
  - 端口角色
    - 根端口
    - 指定端口
    - 边缘端口(Edge) 直接连接终端的端口
    - 替代端口(Alternate) 根端口的替代
    - 备份端口(Backup) 指定端口的备份
  - 端口状态 丢弃、学习、转发
  - 快速收敛机制
    - 边缘端口机制
    - 根端口快速切换机制
    - 指定端口快速切换机制
- 多生成树协议 MSTP
  - 基于实例生成多个生成树,实例之间实现负载均衡
  - 多个 VLAN 对应一个 VLAN 实例(生成树)

## 以太网通道

- 别名:以太网通道/链路聚合/端口聚合/eth-trunk
- 多条链路负载均衡、提高带宽
- 容错 一条链路失效时,使用其他链路通信
- 以太网通道捆绑规则
  - 参与捆绑的端口必须属于同一个 VLAN
  - 如果端口中配置的是中继模式,该链路两端将通道中的所有端口配置成相同的中继模式
  - 所有参与捆绑的端口的物理参数设置必须相同
- 聚合方式
  - 手动汇聚
  - 自动汇聚(协议)
    - PAGP(端口聚合协议): Cisco 私有
    - LACP(链路聚合控制协议): IEEE802.3ad

## 无线局域网

- 无线数据网种类
  - 无线个人网 WPAN
    - IEEE802.15
    - 蓝牙
    - <=10m
  - 无线局域网 WLAN
    - IEEE802.11
    - <=100m
  - 无线城域网 WMAN
    - IEEE802.16
    - 2~10km
  - 无线广域网 WMAN
    - IEEE802.20&3 蜂窝移动通信
- 优势
  - 移动性
  - 灵活性
  - 成本低
  - 容易扩充
- 接入方式
  - 有接入点模式 Infrastructure 结构
  - 无接入点模式 Ad-hoc 模式
- WLAN 标准
  | 标准 | 运行频段 | 主要技术 | 数据速率 |
  | --- | --- | --- | --- |
  | 802.11 | 2.4GHz | 扩频通信技术 | 1Mbps 和 2Mbps |
  | 802.11b | 2.4GHz | HR-DSSS | 11Mbps |
  | 802.11a | 5GHz | OFDM | 54Mbps |
  | 802.11g | 2.4GHz | OFDM | 54Mbps |
  | 802.11n | 2.4GHz 和 5GHz | MIMO 和 OFDM | 600Mbps(实际 300Mbps) |
  | 802.11ac | 2.4GHz | MIMO 和 OFDM | 1Gbps |
  | 802.11ax(WiFi6) | 2.4GHz 和 5GHz | MIMO 和 OFDM | 11Gbps |

  {% collapse 扩频通信技术 %}
  要发送的信息扩展到一个很宽的频段上,以很宽的信道传送信息,
  抗干扰和抗衰落能力强,抗阻塞能力强。
  包括调频扩频(FHSS)和直接序列扩频(DSSS)
  {% endcollapse %}

  {% alertpanel info 2.4GHz无线覆盖 %}

  - 单个信道带宽 22MHz
  - 可以组成(1,6,11),(2,7,12),(3,8,13),~~(4,9,14)~~ 互不干扰的信道进行无线覆盖
  - 中国未开放 14 号信道,有些国家未开放 12,13,14 信道
    ![2.4GHz信道](//img.hoboro.top/picgo/20210328163424.png)
    {% endalertpanel %}

- 隐蔽站和暴露站问题
  ![隐蔽站问题](//img.hoboro.top/picgo/20210328163815.png)
  ![暴露站问题](//img.hoboro.top/picgo/20210328163909.png)
  - 解决方式 使用改进的 CSMA 协议
    - CSMA 增加一个碰撞避免(Collision Avoidance)的功能
    - IEEE802.11 使用 CSMA/CA 协议的同时,增加使用停止等待协议
- MAC 层的 2 个子层
  - DCF 子层 每一个结点使用 CSMA 机制分布式接入算法,让各个站通过争用信道来获取发送权
  - PCF 子层 集中控制的接入算法,将发送数据权轮流交给各个站,从而避免碰撞的产生(可选)
    ![DCF和PCF](//img.hoboro.top/picgo/20210328164647.png)
- WLAN 安全性
  - 更改默认配置
  - 更新 AP 的 Fireware
  - 屏蔽 SSID 广播
  - 加密
    - WEP RC4 的对称加密算法,弱密钥问题,容易被暴力破解
    - WPA 引入 TKIP(临时密钥完整协议)
    - WPA2 AES 加密算法,采用 CCMP 加密包替代 TKIP
  - 认证
    - 开放
    - MAC 地址认证
    - 802.1x 认证 802.1x 客户端-(EAPOL 帧)->AP->认证服务器
    - 预共享密钥
    - WEB 认证
- 组网
  - AP
    - 胖 AP(家用无线路由器)
    - 瘦 AP(只保留无线接入的基本功能,配合 AC 使用)
  - 认证
    ![AC+AP组网实例](//img.hoboro.top/picgo/20210328165805.png)
    - 客户端发送 CAPWAP 报文
    - DHCP 服务器设置`option-43`设置 AC 的 ip,告知 AC

## 综合布线技术

![6大子系统](//img.hoboro.top/picgo/20210328170121.png)

| 子系统 | 位置                     | 备注                 |
| ------ | ------------------------ | -------------------- |
| 工作   | 信息插座之间的线缆       | 离地面高度 30cm~40cm |
| 水平   | 楼层配线间->墙面信息插座 | <90m                 |
| 管理   | 楼层配线间               |                      |
| 干线   | 连接各楼层               |                      |
| 设备间 | 集中安装大型设备         |                      |
| 建筑群 | 连接各个建筑             |                      |
